version: "3.9"

services:
  playwright-bridge:
    build: .
    container_name: playwright-bridge-1

    # Stability fixes for browsers in containers
    init: true
    ipc: host
    shm_size: "1gb"

    environment:
      - MCPO_API_KEY=${MCPO_API_KEY}

      # Force MCP to use Firefox
      - PLAYWRIGHT_MCP_BROWSER=firefox
      - PLAYWRIGHT_MCP_HEADLESS=1
      - PLAYWRIGHT_MCP_TIMEOUT_NAVIGATION=180000
      - PLAYWRIGHT_MCP_TIMEOUT_ACTION=30000

      # Use Playwright's preinstalled browsers directory
      - PLAYWRIGHT_BROWSERS_PATH=/ms-playwright
      - PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1

      # Persist session/cookies in a stable profile directory
      - PLAYWRIGHT_MCP_USER_DATA_DIR=/data/profile

      # Where our importer reads cookies from
      - COOKIES_PATH=/data/cookies.json

    ports:
      - "8010:8000"

    networks:
      - shared-net

    # Mount cookies and persist the profile
    volumes:
      - ./cookies.json:/data/cookies.json:ro
      - playwright_profile:/data/profile

    restart: unless-stopped

networks:
  shared-net:
    external: true

volumes:
  playwright_profile:
